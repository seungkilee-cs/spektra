(function(){"use strict";let r,w=null;function g(){return(w===null||w.byteLength===0)&&(w=new Uint8Array(r.memory.buffer)),w}let b=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&b.decode();const L=2146435072;let p=0;function k(e,t){return p+=t,p>=L&&(b=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}},b.decode(),p=t),b.decode(g().subarray(e,e+t))}function y(e,t){return e=e>>>0,k(e,t)}let _=0;const d=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},B=typeof d.encodeInto=="function"?function(e,t){return d.encodeInto(e,t)}:function(e,t){const n=d.encode(e);return t.set(n),{read:e.length,written:n.length}};function I(e,t,n){if(n===void 0){const a=d.encode(e),u=t(a.length,1)>>>0;return g().subarray(u,u+a.length).set(a),_=a.length,u}let s=e.length,o=t(s,1)>>>0;const c=g();let i=0;for(;i<s;i++){const a=e.charCodeAt(i);if(a>127)break;c[o+i]=a}if(i!==s){i!==0&&(e=e.slice(i)),o=n(o,s,s=i+e.length*3,1)>>>0;const a=g().subarray(o+i,o+s),u=B(e,a);i+=u.written,o=n(o,s,i,1)>>>0}return _=i,o}let f=null;function x(){return(f===null||f.buffer.detached===!0||f.buffer.detached===void 0&&f.buffer!==r.memory.buffer)&&(f=new DataView(r.memory.buffer)),f}let l=null;function S(){return(l===null||l.byteLength===0)&&(l=new Float32Array(r.memory.buffer)),l}function m(e,t){return e=e>>>0,S().subarray(e/4,e/4+t)}function h(e,t){const n=t(e.length*4,4)>>>0;return S().set(e,n/4),_=e.length,n}function W(e){return e==null}const v=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_spectrogrambatch_free(e>>>0,1));class E{static __wrap(t){t=t>>>0;const n=Object.create(E.prototype);return n.__wbg_ptr=t,v.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,v.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_spectrogrambatch_free(t,0)}get data(){const t=r.spectrogrambatch_data(this.__wbg_ptr);var n=m(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}get num_windows(){return r.spectrogrambatch_num_windows(this.__wbg_ptr)>>>0}get freq_bins(){return r.spectrogrambatch_freq_bins(this.__wbg_ptr)>>>0}}const D=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_wasmspectrogramprocessor_free(e>>>0,1));class U{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,D.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_wasmspectrogramprocessor_free(t,0)}constructor(t){const n=r.wasmspectrogramprocessor_new(t);return this.__wbg_ptr=n>>>0,D.register(this,this.__wbg_ptr,this),this}process_window(t){const n=h(t,r.__wbindgen_malloc),s=_,o=r.wasmspectrogramprocessor_process_window(this.__wbg_ptr,n,s);var c=m(o[0],o[1]).slice();return r.__wbindgen_free(o[0],o[1]*4,4),c}compute_spectrogram(t,n){const s=h(t,r.__wbindgen_malloc),o=_,c=r.wasmspectrogramprocessor_compute_spectrogram(this.__wbg_ptr,s,o,n);var i=m(c[0],c[1]).slice();return r.__wbindgen_free(c[0],c[1]*4,4),i}process_windows(t,n,s,o){const c=h(t,r.__wbindgen_malloc),i=_,a=r.wasmspectrogramprocessor_process_windows(this.__wbg_ptr,c,i,n,W(s)?4294967297:s>>>0,W(o)?4294967297:o>>>0);return E.__wrap(a)}}const j=new Set(["basic","cors","default"]);async function q(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(s){if(e.ok&&j.has(e.type)&&e.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function C(){const e={};return e.wbg={},e.wbg.__wbg_error_7534b8e9a36f1ab4=function(t,n){let s,o;try{s=t,o=n,console.error(y(t,n))}finally{r.__wbindgen_free(s,o,1)}},e.wbg.__wbg_log_17e39c8298fef94f=function(t,n){console.log(y(t,n))},e.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},e.wbg.__wbg_stack_0ed75d68575b0f3c=function(t,n){const s=n.stack,o=I(s,r.__wbindgen_malloc,r.__wbindgen_realloc),c=_;x().setInt32(t+4*1,c,!0),x().setInt32(t+4*0,o,!0)},e.wbg.__wbg_wbindgenthrow_4c11a24fca429ccf=function(t,n){throw new Error(y(t,n))},e.wbg.__wbindgen_init_externref_table=function(){const t=r.__wbindgen_export_3,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},e}function V(e,t){return r=e.exports,R.__wbindgen_wasm_module=t,f=null,l=null,w=null,r.__wbindgen_start(),r}async function R(e){if(r!==void 0)return r;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/spektra/assets/rust_audio_processor_bg-zgASwbGZ.wasm",self.location.href));const t=C();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:s}=await q(await e,t);return V(n,s)}let A,F=null,M=null;async function N(){A||(A=R()),await A}function X(e){return(!F||M!==e)&&(F=new U(e),M=e),F}self.addEventListener("message",async e=>{const{data:t}=e;if(!t||t.type!=="process")return;const{audioData:n,fftSize:s,overlap:o,profiling:c}=t;try{await N();const i=X(s);let a;const u=c?performance.now():0,T=i.process_windows(n,o,null,null),Y=c?performance.now():0,O=new Float32Array(T.data),z=T.num_windows,P=T.freq_bins;c&&(a={fftMs:(Y-u).toFixed(2),numWindows:z,freqBins:P}),self.postMessage({success:!0,spectrogramFlat:O,numWindows:z,freqBins:P,timings:a},[O.buffer])}catch(i){self.postMessage({success:!1,message:(i==null?void 0:i.message)||String(i)})}})})();
